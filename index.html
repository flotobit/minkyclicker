<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Minky Clicker</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background-color: #fffbea;
  }
  #monkeyButton img {
    width: 150px;
    cursor: pointer;
    transition: transform 0.2s ease;
  }
  #monkeyButton img:hover {
    transform: scale(1.15);
  }
  #settingsButton img {
    width: 50px;
    cursor: pointer;
    position: fixed;
    top: 10px;
    right: 10px;
  }
  #settingsPanel {
    display: none;
    position: fixed;
    top: 30%;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    border: 2px solid #444;
    padding: 20px;
    z-index: 1000;
    width: 300px;
    max-height: 400px;
    overflow-y: auto;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
  }
  #settingsPanel h3 {
    margin-top: 0;
  }
  .monkeyOption {
    display: flex;
    align-items: center;
    margin: 10px 0;
    cursor: pointer;
    position: relative;
  }
  .monkeyOption img.monkeyImg {
    width: 70px;
    margin-right: 10px;
  }
  .checkMark {
    position: absolute;
    right: 5px;
    width: 25px;
    height: 25px;
  }
  #closeSettingsBtn {
    margin-top: 15px;
    font-size: 14px;
    padding: 6px 12px;
    cursor: pointer;
  }
  #bananasDisplay {
    font-size: 18px;
    margin-bottom: 15px;
  }
  #rebirthReq {
    font-weight: bold;
    margin-bottom: 15px;
  }
</style>
</head>
<body>

<h1>Minky Clicker</h1>
<div id="bananasDisplay">Bananas: 0</div>
<div id="rebirthReq">Rebirth cost: 1,000,000 bananas</div>

<button id="monkeyButton" aria-label="Monkey Click Button">
  <img id="monkeyImg" src="monkeu.webp" alt="Monkey Click Button" />
</button>

<button id="settingsButton" aria-label="Settings">
  <img src="gear-icon.webp" alt="Settings Icon" />
</button>

<div id="settingsPanel" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
  <h3 id="settingsTitle">Choose your Monkey</h3>
  <div id="monkeyOptions"></div>
  <button id="closeSettingsBtn">Close</button>
</div>

<script>
  // Images list for each rebirth stage - upload your monkey images with these filenames to repo root
  const monkeys = [
    "monkeu.webp",
    "monkey-rebirth1.webp",
    "monkey-rebirth2.webp"
    // Add more monkey images here as needed
  ];
  const gearIcon = "gear-icon.webp"; // Not used in JS but you have it
  const checkMarkIcon = "checkmark.webp"; // Checkmark overlay icon

  const baseRebirthCost = 1000000;
  let bananas = 0;
  let rebirthCount = 0;
  let equippedMonkey = 0;

  // Load saved state from localStorage
  function loadState() {
    const savedBananas = parseInt(localStorage.getItem("bananas"));
    bananas = isNaN(savedBananas) ? 0 : savedBananas;
    const savedRebirth = parseInt(localStorage.getItem("rebirthCount"));
    rebirthCount = isNaN(savedRebirth) ? 0 : savedRebirth;
    const savedEquipped = parseInt(localStorage.getItem("equippedMonkey"));
    equippedMonkey = isNaN(savedEquipped) ? 0 : savedEquipped;
  }

  // Save state to localStorage
  function saveState() {
    localStorage.setItem("bananas", bananas);
    localStorage.setItem("rebirthCount", rebirthCount);
    localStorage.setItem("equippedMonkey", equippedMonkey);
  }

  // Update the monkey button image depending on equipped monkey
  function updateMonkeyButton() {
    const monkeyImg = document.getElementById("monkeyImg");
    monkeyImg.src = monkeys[equippedMonkey] || monkeys[0];
  }

  // Update bananas and rebirth UI displays
  function updateDisplays() {
    document.getElementById("bananasDisplay").textContent = `Bananas: ${bananas.toLocaleString()}`;
    const nextCost = baseRebirthCost * Math.pow(2, rebirthCount);
    document.getElementById("rebirthReq").textContent = `Rebirth cost: ${nextCost.toLocaleString()} bananas`;
  }

  // Handle clicking monkey button to gain bananas
  function onMonkeyClick() {
    bananas += 1;
    updateDisplays();
    saveState();
  }

  // Check if player can rebirth based on bananas
  function canRebirth() {
    const cost = baseRebirthCost * Math.pow(2, rebirthCount);
    return bananas >= cost;
  }

  // Perform rebirth if possible
  function doRebirth() {
    if (!canRebirth()) {
      alert("You don't have enough bananas to rebirth!");
      return;
    }
    const cost = baseRebirthCost * Math.pow(2, rebirthCount);
    bananas -= cost;
    rebirthCount++;
    equippedMonkey = Math.min(rebirthCount, monkeys.length -1); // Equip new monkey unlocked
    updateMonkeyButton();
    updateDisplays();
    saveState();
    alert("Rebirth successful! Your monkey has changed.");
  }

  // Show settings panel to select equipped monkey
  function openSettings() {
    const panel = document.getElementById("settingsPanel");
    panel.style.display = "block";
    renderSettingsOptions();
  }

  // Hide settings panel
  function closeSettings() {
    document.getElementById("settingsPanel").style.display = "none";
  }

  // Render the monkey selection options in settings
  function renderSettingsOptions() {
    const container = document.getElementById("monkeyOptions");
    container.innerHTML = ""; // Clear previous
    monkeys.forEach((monkey, idx) => {
      const div = document.createElement("div");
      div.className = "monkeyOption";
      div.setAttribute("tabindex", "0");
      div.setAttribute("role", "button");
      div.setAttribute("aria-pressed", equippedMonkey === idx ? "true" : "false");

      const img = document.createElement("img");
      img.src = monkey;
      img.alt = `Monkey ${idx + 1}`;
      img.className = "monkeyImg";

      div.appendChild(img);

      if (idx === equippedMonkey) {
        const check = document.createElement("img");
        check.src = checkMarkIcon;
        check.alt = "Equipped";
        check.className = "checkMark";
        div.appendChild(check);
      }

      div.onclick = () => {
        // Restrict selection to monkeys unlocked by rebirth
        if (idx <= rebirthCount) {
          equippedMonkey = idx;
          updateMonkeyButton();
          saveState();
          renderSettingsOptions(); // Refresh display
        } else {
          alert("You have not unlocked this monkey yet!");
        }
      };

      div.onkeypress = (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          div.click();
        }
      };

      container.appendChild(div);
    });
  }

  // Initialization on page load
  function init() {
    loadState();
    updateDisplays();
    updateMonkeyButton();

    // Set button event listeners
    document.getElementById("monkeyButton").addEventListener("click", onMonkeyClick);
    document.getElementById("monkeyButton").addEventListener("dblclick", doRebirth);
    document.getElementById("settingsButton").addEventListener("click", openSettings);
    document.getElementById("closeSettingsBtn").addEventListener("click", closeSettings);

    // Accessibility: close settings on escape key
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        closeSettings();
      }
    });
  }

  window.onload = init;
</script>

</body>
</html>
